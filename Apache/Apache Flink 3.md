# Apache Flink

아파치 플링크는 2011년 첫 릴리즈된 비교적 오래된 프레임워크이다. 개발 초기에는 많은 관심을 끌지 못했으나 빠르게 성정해 현재 주요 글로벌 대기업들이 사용하는 스트림 프로세서로 자리했다. 

스트림 프로세싱의 기존 선두주자는 스파크이다. 스파크는 플링크보다 높은 프로젝트 성숙도와 점유율을 보여왔다. 하지만 플링크는 스파크 다음 세대의 빅데이터 분석 프레임워크로서 짧은 지연시간 내에 스트림 데이터를 처리하면서도 강력한 상태 관리가 필요한 경우 최적의 선택이 될 수 있다. 플링크의 네이티브 스트림과 스파크의 소규모 일괄처리로 인해 발생하는 지연시간은 데이터가 적은 환경에서는 그 차이가 미미할 수 있지만 하루에 1조 개 이상의 데이터가 생성되는 환경이라면 결코 무시할 수 없을 것이다.

플링크가 다른 프레임워크와 차별화되는 주요 특징은 다음과 같다.

- **Native Stream**: 플링크는 일괄처리도 지원하지만 스트림 프로세싱을 주목적으로 사용한다. 경량의 분산 스냅샷을 구현하여 오버헤드는 낮으면서 Exactly-once의 이벤트 처리를 보장할 수 있다.
- **In-Memory**: 자바 애플리케이션으로 JVM에서 실행되지만 JVM GC에 전적으로 의존하지 않는다. 대신 커스텀 메모리 매니저를 구현하여 안정적인 메모리 사용량을 유지하며 성능의 향상을 꾀하고 있다.
- **낮은 지연과 높은 처리량(Throughput)**: 경쟁 제품에 비해 지연과 처리량에서 우수한 성능을 보인다. 플링크는 데이터를 처리하는 과정에서 변경된 부분만 재처리하도록 설정하여 처리 속도를 높일 수 있다.
- **손쉬운 설정과 사용 그리고 강력한 부가 기능**: 스파크는 파라미터 설정이 복잡하지만 플링크는 별다른 설정 없이 사용할 수 있다. 입력되는 이벤트 스트림에 개별로 접근할 수 있고, 강력한 윈도우 연산자를 사용하여 분석을 수행할 수 있다. 고급 분석용 API부터 상세히 제어가 가능한 상태 저장 이벤트 기반 애플리케이션 수준까지 계층별 API를 제공한다.



## Flink Architecture

플링크에서의 데이터는 Source로 시작해 Sink로 끝난다. 데이터가 입력되어 처리가 완료되기까지의 각 단계는 스트림으로 이동하고 오퍼레이터에 의해 데이터가 처리된다. 소스는 데이터 입력을 정의하는 단계로 원천시스템의 로그, 클릭 이벤트, IoT 장치 등에서 발생하는 데이터를 실시간 이벤트 스트림이나 데이터베이스, 파일, K-V Store 따위의 매체로부터 수신한다.

트랜스포메이션은 데이터를 가공하는 작업이다. 스트림 내의 특정 값에 가중치를 주거나 분석하여 새로운 스트림을 형성할 수도 있고, 특정 키 값 기반 스트림을 처리할 수도 있다. 스트림 처리 시스템의 기본 개념인 윈도우 관련 기능도 제공한다. 윈도우는 제한이 없는(Unbounded) 데이터 흐름에서 집계 및 가공 처리 수행을 위해 유한한(Bounded) 단위로 구분하는 개념이다.



플링크는 윈도우 할당 방식으로 Tumbling, Sliding, Session, Global 윈도우를 지원한다.

| 윈도우   | 설명                                                         |
| -------- | ------------------------------------------------------------ |
| Tumbling | - 고정된 단위시간에 따라 윈도우를 나누어 데이터 중복 없음<br />- 지정된 기간을 윈도우 크기로 하여 각 윈도우 안의 데이터 처리 |
| Sliding  | - Tumbling의 윈도우 크기에 Slide 기간 만큼 + or - 중복 허용<br />- 특정 기간 내의 평균값 처리 등을 목적으로 할 때 |
| Session  | - 윈도우의 크기가 일정하지 않음<br />- 임계치 이상의 Session Gap 간격을 갖는 경우 다른 윈도우로 구분 |
| Global   | - 하나의 동일한 키 단위나 윈도우로 모든 데이터 처리          |



마지막 단계인 싱크는 처리한 스트림을 출력, 저장하는 단계이다. 플링크의 계산 결과값이 필요할 때까지 계산을 늦추어 불필요한 연산을 피하는 Lazy Evaluation 방식을 채택하고 있다. 따라서 싱크 단계를 수행함에 따라 처리 결과를 소비할 애플리케이션, 이벤트 로그 또는 데이터베이스 등으로 출력하게 된다. 플링크는 위와 같은 데이터 흐름 중 체크포인트를 설정해 내결함성을 높이고 **Exactly-once**를 보장한다. 아울러 이벤트가 발생한 시간과 처리된 시간을 구분하고 워터마크를 활용하여 지연 데이터를 처리함으로써 신뢰성과 고성능을 지원하고 있다.



출처 : https://www.samsungsds.com/kr/insights/flink.html