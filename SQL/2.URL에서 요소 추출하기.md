# URL에서 요소 추출하기

---

> SQL> URL 함수, 정규 표현식

- 데이터

```text
-[ RECORD 1 ]---------------------------------------------------------------
stamp    | 2016-08-26 12:02:00
referrer | http://www.other.com/path1/index.php?k1=v1&k2=v2#Ref1
url      | http://www.example.com/video/detail?id=001
-[ RECORD 2 ]---------------------------------------------------------------
stamp    | 2016-08-26 12:02:01
referrer | http://www.other.net/path1/index.php?k1=v1&k2=v2#Ref1
url      | http://www.example.com/video#ref
-[ RECORD 3 ]---------------------------------------------------------------
stamp    | 2016-08-26 12:02:01
referrer | http://www.other.com/
url      | http://www.example.com/book/detail?id=002
```

- 레퍼러 도메인을 추출하는 쿼리

```sql
SELECT
	stamp,
	-- referrer의 호스트 이름 부분 추출하기
	-- PostgreSQL : substring 함수와 정규 표현식 사용하기
	substring(referrer from 'https?://([^/]*)') AS referrer_host,
	
	-- Redshift : 정규 표현식에 그룹을 조합해서 사용할 수 없으므로
	-- regexp_substr 함수와 regexp_replace 함수를 조합해서 사용하기
	regexp_replace(regexp_substr(referrer, 'http?://[^/]*'), 'http?://', '') AS referrer_host
	
	-- Hive, SparkSQL : parse_url 함수로 호스트 이름 추출하기
	parse_url(referrer, 'HOST') AS referrer_host,
	
	-- BigQuery : host 함수 사용하기
	host(referrer) AS referrer_host
FROM access_log;
```

- 실행결과

| stamp               | referrer_host |
| ------------------- | ------------- |
| 2016-08-26 12:02:00 | www.other.com |
| 2016-08-26 12:02:01 | www.other.net |
| 2016-08-26 12:02:01 | www.other.com |



